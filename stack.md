# 技术选型文档 (Technology Stack)

## 项目概述
游戏Mod翻译器 - 用于扫描和翻译游戏插件文件的桌面应用程序

---

## 前端技术栈

### 核心框架
- **React** `19.1.0`
  - 最新版本，提供现代化的组件开发体验
  - 支持并发特性和自动批处理优化

- **TypeScript** `~5.8.3`
  - 强类型支持，提升代码可维护性
  - 完整的IDE智能提示

- **Vite** `^7.0.4`
  - 极速的开发服务器和HMR
  - 优化的生产构建

### UI框架
- **Material-UI (MUI)** `latest`
  - 成熟的React组件库
  - 开箱即用的Material Design风格
  - 丰富的组件生态（Drawer, List, TextField等）
  - 内置响应式和主题系统

**选型理由**：
- ✅ 组件完整度高，减少自定义开发
- ✅ 文档完善，学习曲线平缓
- ✅ 社区活跃，长期维护
- ✅ 适合桌面应用的复杂布局需求

### 路由管理
- **react-router-dom** `latest`
  - React生态标准路由方案
  - 声明式路由配置
  - 支持懒加载和代码分割

**路由设计**：
```
/ - 首屏（游戏目录选择）
/workspace - 主工作界面
```

### 状态管理
- **Zustand** `latest`
  - 轻量级状态管理库（~1KB）
  - API简洁，无样板代码
  - 原生TypeScript支持
  - 性能优异，支持选择性订阅

**选型理由**：
- ✅ 相比Redux更简单直观
- ✅ 相比Context API性能更好
- ✅ 适合中小型应用的状态管理需求
- ✅ 学习成本低，易于团队协作

### 不可变更新
- **Immer** `10.2.0`
  - 现代化的不可变状态管理库
  - 使用 `produce()` API 简化复杂对象更新
  - 内置结构共享优化
  - 显著减少内存占用（大数据集场景）

**应用场景**：
- ✅ Session 数据更新（12万+条记录）
- ✅ 批量翻译应用（避免数组深拷贝）
- ✅ 内存优化（节省60-70%内存占用）

---

## 后端技术栈

### 核心框架
- **Tauri** `2.x`
  - 现代化的跨平台桌面应用框架
  - 使用系统WebView，体积小巧
  - 安全的前后端通信机制
  - 原生文件系统访问能力

- **Rust** `2021 Edition`
  - 内存安全，无运行时开销
  - 出色的并发性能
  - 丰富的系统编程能力

### Rust依赖库

#### 核心依赖
- **serde** `1.x` & **serde_json** `1.x`
  - JSON序列化/反序列化
  - 用于settings.json配置文件处理
  - 与前端数据交互

- **walkdir** `2.x`
  - 递归目录遍历
  - 用于扫描游戏Data目录下的插件文件
  - 高效的文件系统操作

- **directories** `5.x`
  - 跨平台路径获取
  - 获取应用可执行文件路径
  - 用于settings.json存储位置定位

- **rusqlite** `0.32`
  - SQLite数据库驱动
  - 翻译数据持久化存储
  - WAL模式支持并发读写

- **esp_extractor** `0.5.2`
  - ESP/ESM/ESL文件解析
  - 26倍性能提升（v0.5.2）
  - 支持双语提取

- **aho-corasick** `1.1`
  - 多模式字符串匹配算法
  - 用于原子数据库术语替换
  - O(n+m)复杂度，高效匹配10000+模式

- **rayon** `1.x`
  - 并行计算框架
  - 多核批量操作加速

- **tokio** `1.48.0`
  - 异步运行时
  - 用于异步事件处理

#### Tauri插件
- **tauri-plugin-opener** `2.x`
  - 打开外部链接和文件（预留功能）

---

## 构建工具链

### 前端构建
- **Vite** - 开发服务器和生产构建
- **TypeScript Compiler** - 类型检查
- **@vitejs/plugin-react** - React Fast Refresh支持

### 后端构建
- **Cargo** - Rust包管理和构建系统
- **tauri-cli** - Tauri应用打包工具

### 包管理器
- **pnpm** - 快速、节省磁盘空间的包管理器

---

## 开发规范

### 代码风格
- **前端**：遵循React Hooks最佳实践
- **后端**：遵循Rust官方代码风格（rustfmt）

### 文件组织
```
src/
├── components/     # React组件
├── pages/          # 页面组件
├── stores/         # Zustand状态管理
├── types/          # TypeScript类型定义
└── utils/          # 工具函数

src-tauri/src/
├── main.rs         # 应用入口
├── lib.rs          # Tauri命令注册
├── settings.rs     # 配置管理模块
└── scanner.rs      # 插件扫描模块
```

---

## 数据流设计

### 前后端通信
```
前端 (React)
    ↕ invoke/emit
后端 (Rust)
    ↕ 文件系统
本地文件 (settings.json, *.esp/esm/esl)
```

### 状态管理流
```
用户操作 → Zustand Action → Tauri Command → Rust处理 → 返回结果 → 更新Store → UI重渲染
```

---

## 性能考量

1. **插件扫描**：使用Rust异步I/O，避免阻塞UI
2. **列表渲染**：MUI DataGrid 虚拟滚动，支持12万+条数据流畅显示
3. **搜索过滤**：前端内存过滤，响应迅速
4. **配置读写**：缓存在Zustand store，减少磁盘I/O
5. **内存优化**：
   - 使用 Immer 避免大数组深拷贝（节省60-70%内存）
   - React.memo + key 优化组件缓存清理
   - 显式资源释放（Map.clear() + finally 块）
   - 大文件场景内存峰值优化（9-10GB → 3-4GB）

---

## 扩展性预留

1. **插件元数据解析**：预留接口，后续接入专门的Rust库
2. **翻译功能**：中间区域预留Placeholder，待后续实现
3. **主题切换**：MUI主题系统支持快速切换
4. **多语言支持**：可集成i18n库

---

## 依赖版本锁定策略

- **主要依赖**：使用 `^` 允许次版本更新
- **Tauri生态**：严格锁定版本 `2.x`
- **定期维护**：每月检查依赖安全更新

---

**文档版本**: v0.1.0
**更新日期**: 2025-11-14
**维护者**: orcax
